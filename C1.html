<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>WORPUZZ C2</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #209087;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
  }
  h1 {
    font-size: 3em;
    margin: 20px 0 10px;
    color: #EF0;
  }
  p.rule {
    margin: 0 0 10px;
    font-size: 1em;
    color: #EF0;
    text-align: center;
    line-height: 1.4;
  }
  .container {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    margin-bottom: 10px;
  }
  #npcScore, #userScore {
    background-color: #209087;
    color: #fff;
    width: 180px;
    min-height: 300px;
    padding: 10px;
    box-sizing: border-box;
    border: none;
    border-radius: 12px;
  }
  #npcScore h2, #userScore h2 {
    font-size: 1.2em;
    margin-top: 0;
    margin-bottom: 10px;
  }
  #npcScore p, #userScore p {
    font-size: 1.1em;
    margin: 5px 0;
  }
  #game {
    display: grid;
    grid-template-columns: repeat(10, 50px);
    grid-gap: 5px;
    padding: 10px;
    background-color: #0E756D;
    border-radius: 12px;
  }
  .cell {
    width: 50px;
    height: 50px;
    background-color: #CFF9FF;
    color: #0A6A79;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.3em;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    border-radius: 4px;
  }
  .revealed {
    background-color: #fff;
  }
  .revealed.clover {
    background-color: #d0f5d0;
    font-size: 1.5em;
  }
  .word-owned-user {
    background-color: #fff9c4;
  }
  .word-owned-npc {
    background-color: #ffe0e0;
  }
  .btn-container {
    display: flex;
    gap: 10px;
    margin: 15px;
  }
  button {
    font-size: 1.1em;
    padding: 10px 20px;
    cursor: pointer;
    background-color: #CFF9FF;
    color: #0A6A79;
    border-radius: 12px;
    border: none;
  }
  button:hover {
    background-color: #1baf8f;
    color: #fff;
  }
</style>
</head>
<body>

<h1>WORPUZZ C2</h1>
<p class="rule">
Find the words hidden horizontally ‚Üí,vertically ‚Üì, or diagonally ‚Üò. <br>
If you spot a four-leaf clover üçÄ, you earn an extra turn! <br>
Compete against the computer ‚Äî whoever finds the most wins!
</p>

<div class="container">
  <div id="npcScore">
    <h2>computer:</h2>
  </div>
  <div id="game"></div>
  <div id="userScore">
    <h2>user:</h2>
  </div>
</div>

<div class="btn-container">
  <button id="retryBtn">RETRY</button>
  <button onclick="location.href='index.html'">HOME</button>
</div>

<script>
const wordList = [

"ARM","ASH","BAT","BAY","BOW","COP","DAM","DIP","DUB","DUO","EGO","FIT","GUT","LAD","LAP","LOG","MOB","NET","NOD","OPT","PAD","PIT","POP","RAY","RIP","ROD","SAY","SIN","SPY","SUE","TOP","VOW","WIT",
"ACID","ACRE","AIDE","ALLY","AMID","AUTO","BAIL","BARE","BASS","BEAM","BIND","BOOM","BUCK","BULK","COUP","CULT","DAWN","DEED","DEEM","DEFY","DOSE","DUAL","DUMB","EASE","ECHO","EXIT","FADE","FATE","FEAT","FINE","FLAW","FLEE","GAZE","GEAR","GRID","GRIN","GRIP","HAIL","HALT","HINT","HOOK","HORN","JUST","LAWN","LEAK","LEAP","LIMB","LOOM","LOOP","MASK","MEMO","MERE","MILL","MONK","NEST","NOON","ODDS","ORAL","PEAK","PLEA","PLUG","POLE","POLL","POND","PREY","PUMP","RAGE","RAID","RAPE","REAR","RIOT","ROCK","SACK","SAKE","SEAL","SHED","SIGH","SKIP","SLAM","SLAP","SLOT","SNAP","SOAK","SOAR","SOLE","SOLO","SPAM","SPAN","SPIN","STAB","STEM","STIR","STUN","SUCK","TIDE","TOLL","TOSS","TRIO","VEIN","VICE","WARD","WEED","WELL","WHIP","WIPE","YELL",
"ABUSE","ACUTE","ALERT","ALIEN","ALIGN","ALIKE","AMEND","ANGEL","ARENA","ARRAY","AUDIT","AWAIT","BEAST","BENCH","BLADE","BLAST","BLEED","BLEND","BLESS","BOAST","BONUS","BREED","BUDDY","BURST","CARGO","CARVE","CATER","CEASE","CHAOS","CHARM","CHUNK","CIVIC","CLASH","CLING","CRAFT","CRAWL","CREEP","CROWN","CRUDE","CRUSH","DEBUT","DEMON","DENSE","DEVIL","DONOR","DRAIN","DRIFT","DROWN","EAGER","ELITE","EMBED","ENACT","ENROL","ENSUE","ERECT","EVOKE","EXERT","EXILE","FATAL","FIBRE","FLEET","FLESH","FLUID","FORGE","FORTH","GLORY","GRACE","GRASP","GRAVE","GRIEF","GRIND","GROSS","GUILT","HANDY","HARSH","HAUNT","IDIOT","INCUR","IRONY","LASER","LIVER","LOBBY","LOGIC","MARCH","MERCY","MERGE","MERIT","MIDST","NAVAL","NICHE","NOBLE","NOVEL","PATCH","PLEAD","PROBE","PULSE","PUNCH","QUERY","QUEST","QUOTA","RADAR","RALLY","RATIO","REALM","REBEL","REIGN","RENEW","RIFLE","SAINT","SCOPE","SCREW","SEIZE","SETUP","SHEER","SHOOT","SHRUG","SLASH","SMASH","SOUND","SPARE","SPARK","SPELL","SPINE","SQUAD","STAKE","STARK","STEER","STRIP","SUITE","SURGE","SWING","SWORD","TEMPT","TOTAL","TOXIC","TRACE","TRAIL","TWIST","UNIFY","VAGUE","VERSE","VOCAL","WEAVE","WIDEN","WIDOW","WIDTH","YIELD",
"ABSENT","ABSURD","ADHERE","ALBEIT","ALLEGE","ANCHOR","ASPIRE","ASSERT","ASYLUM","ATTAIN","BACKUP","BALLOT","BANNER","BARREL","BEHALF","BETRAY","BISHOP","BOUNCE","BREACH","BRUTAL","BUFFER","BURDEN","BURIAL","CANVAS","CASINO","CATTLE","COMBAT","COMPEL","COMPLY","CONFER","COPPER","COSTLY","DEBRIS","DEFECT","DENIAL","DEPICT","DEPLOY","DEPUTY","DETAIN","DEVISE","DIVERT","DIVINE","DOMAIN","EMBARK","EMBODY","ENDURE","ENRICH","ENTITY","EXCESS","EXPIRE","FIERCE","FILTER","FLAWED","FOSTER","GALLON","GLANCE","HATRED","HAZARD","HUMBLE","INDUCE","INFANT","INFECT","INJECT","INMATE","INSULT","INTACT","INTAKE","INTENT","INVOKE","IRONIC","KIDNAP","KIDNEY","LATTER","LAYOUT","LEGACY","LESSER","LETHAL","LIABLE","LINEAR","LINEUP","LINGER","MARINE","MATURE","MELODY","MEMOIR","MENTOR","MERELY","MERGER","MINING","MINUTE","MISERY","MOTIVE","MUTUAL","NAMELY","NOTIFY","OBLIGE","OBSESS","OUTING","OUTLET","OVERLY","PARISH","PASTOR","PATENT","PATROL","PATRON","PIRATE","PLEDGE","PLUNGE","PREACH","REFORM","REFUGE","REGAIN","REGIME","REMEDY","RENDER","RENTAL","RESIDE","RESUME","REVIVE","RITUAL","ROBUST","ROTATE","RULING","RUMOUR","SACRED","SELDOM","SERIAL","SHRINK","SKETCH","SOLELY","SPHERE","SPOUSE","STRAIN","STRAND","STRIVE","SUBTLE","SUMMIT","SUPERB","TACKLE","TACTIC","TENANT","TENDER","TENURE","THREAD","THRIVE","TIMBER","TIMELY","TRAUMA","TREATY","TRIBAL","TROPHY","UNVEIL","UPHOLD","VACUUM","VANISH","VARIED","VERBAL","VERIFY","VERSUS","VESSEL","VIABLE","VIRTUE","WEAKEN","WHILST","WHOLLY","WORTHY",
"ABOLISH","ABSENCE","ACADEMY","ACCUSED","ADVERSE","AMATEUR","ANALOGY","APPLAUD","APPOINT","ARCHIVE","ASSAULT","BACKING","BELOVED","BENEATH","BIZARRE","BROWSER","CABINET","CAUTION","CHAMBER","CHARTER","CHRONIC","CLARITY","CLOSURE","CLUSTER","COASTAL","COMPILE","COMPUTE","CONCEAL","CONCEDE","CONDEMN","CONFINE","CONQUER","CONSENT","CONTEND","CONTENT","CONVICT","CORRUPT","COUNTER","CREATOR","CRYSTAL","CUSTODY","CUTTING","CYNICAL","DEFAULT","DEFICIT","DENSITY","DEPOSIT","DEPRIVE","DESCEND","DESCENT","DESKTOP","DICTATE","DIGNITY","DILEMMA","DISCARD","DISPOSE","DISPUTE","DISRUPT","DISTORT","DRIVING","DYNAMIC","ELEVATE","EMBASSY","EMPOWER","ENDLESS","ENDORSE","ENFORCE","ENQUIRE","ENTITLE","ESSENCE","ETERNAL","EXECUTE","EXTRACT","FACTION","FACULTY","FIREARM","FIXTURE","FOOTAGE","FORMULA","FRAGILE","FRANKLY","FUNERAL","GENERIC","GLIMPSE","GRAVITY","HALFWAY","HANDFUL","HARMONY","HARVEST","HOPEFUL","HORIZON","HOSTAGE","HOSTILE","IMAGERY","IMMENSE","INDULGE","INFLICT","INHIBIT","INSIDER","INSPECT","INTERIM","KINGDOM","LAWSUIT","LENGTHY","LESBIAN","LIBERAL","LIBERTY","LICENSE","LISTING","LOYALTY","MAGICAL","MANDATE","MILITIA","MINIMAL","MIRACLE","MISSILE","NEGLECT","NOMINEE","NOTABLE","NOTABLY","NURSERY","OPTICAL","OUTLOOK","OUTRAGE","OVERSEE","PARTIAL","PASSING","PASSIVE","PATHWAY","PEASANT","PERSIST","PIONEER","PORTRAY","POSTWAR","PREMIER","PREMISE","PREMIUM","PRESIDE","PRESUME","PREVAIL","PROVOKE","RADICAL","RANKING","READILY","RECOUNT","REFUSAL","REMAINS","REMOVAL","RESIDUE","RETREAT","REVENGE","REVERSE","REVIVAL","SECULAR","SEGMENT","SENATOR","SHATTER","SLAVERY","SQUEEZE","STORAGE","STUMBLE","SUBSIDY","SUICIDE","SUPREME","SURPLUS","SUSTAIN","TERRAIN","TESTIFY","TEXTURE","THEREBY","TIGHTEN","TOBACCO","TORTURE","TRAILER","TRANSIT","TRIBUTE","TRIGGER","TRIUMPH","TRUSTEE","TUITION","TURNOUT","UPGRADE","UTILITY","UTILIZE","UTTERLY","VENTURE","VERDICT","VETERAN","VIBRANT","VICIOUS","VIOLATE","WARFARE","WARRANT","WARRIOR","WHEREBY","WORKOUT","WORSHIP",
"ABORTION","ACTIVIST","ADJACENT","ADOPTION","ADVOCATE","ALLIANCE","ALLOCATE","APPETITE","ARGUABLY","ASSEMBLE","ASSEMBLY","ATROCITY","ATTORNEY","AUTONOMY","BACKDROP","BLESSING","BOUNDARY","CARRIAGE","CASUALTY","CAUTIOUS","CEMETERY","CIVILIAN","CLINICAL","COCKTAIL","COINCIDE","COLONIAL","COMMENCE","COMMERCE","CONCEIVE","CONFRONT","CONSERVE","CONTEMPT","CONTRARY","COURTESY","CREDIBLE","CRITIQUE","DAMAGING","DECISIVE","DELEGATE","DELICATE","DENOUNCE","DIAGNOSE","DICTATOR","DIMINISH","DIPLOMAT","DISCLOSE","DISPLACE","DISPOSAL","DISSOLVE","DISTRESS","DOCTRINE","EARNINGS","EDUCATOR","ELIGIBLE","ENGAGING","EPIDEMIC","EQUALITY","EQUATION","ESCALATE","EVACUATE","EXPLICIT","FAIRNESS","FEMINIST","FLOURISH","GAMBLING","GENOCIDE","GLORIOUS","GUIDANCE","HANDLING","HARDWARE","HEIGHTEN","HERITAGE","HOMELAND","HUMANITY","HYDROGEN","IDEOLOGY","IMMINENT","IMPRISON","INCLINED","INFAMOUS","INHERENT","INITIATE","INSTINCT","INSTRUCT","INTEGRAL","INTERIOR","INTIMATE","JUDICIAL","JUNCTION","LANDLORD","LANDMARK","LIFELONG","LITERACY","LONGTIME","MAGNETIC","MAINLAND","MANIFEST","MARGINAL","MASSACRE","MAXIMIZE","MEANTIME","MEDIEVAL","MEMORIAL","MERCHANT","MILITANT","MINIMIZE","MINISTRY","MOBILITY","MOBILIZE","MODERATE","MOMENTUM","MONOPOLY","MORALITY","MOTORIST","NOMINATE","NONSENSE","OFFERING","OPTIMISM","OUTBREAK","OUTSIDER","OVERLOOK","OVERTURN","PARENTAL","PECULIAR","PETITION","PIPELINE","POSTPONE","PREDATOR","PROCEEDS","PROCLAIM","PROFOUND","PROTOCOL","PROVINCE","RATIONAL","REASSURE","REMINDER","RENOWNED","REPUBLIC","RESEMBLE","RETRIEVE","RHETORIC","ROTATION","SANCTION","SCRUTINY","SHIPPING","SIMULATE","SITUATED","SPECIMEN","SPECTRUM","STANDING","STIMULUS","STRIKING","SUBURBAN","SUPERIOR","SUPPRESS","SURGICAL","SYMBOLIC","SYNDROME","TACTICAL","TAXPAYER","TERMINAL","TERRIFIC","THEOLOGY","THRILLED","TOLERATE","TRIBUNAL","TROUBLED","TURNOVER","UPCOMING","VALIDITY","VARIABLE","VILLAGER","WHATEVER",
"ABUNDANCE","ADMISSION","AESTHETIC","AFFECTION","AFTERMATH","ALIGNMENT","ALLEGEDLY","ALLOWANCE","ALUMINIUM","AMENDMENT","ANONYMOUS","APPARATUS","APPEALING","ARBITRARY","ASSERTION","ASSURANCE","ATTRIBUTE","AUTHENTIC","AUTHORIZE","BENCHMARK","BIOGRAPHY","BREAKDOWN","BROADBAND","CATALOGUE","CIRCULATE","COALITION","COGNITIVE","COLLISION","COLUMNIST","COMMODITY","COMMUNIST","COMPANION","COMPETENT","CONSENSUS","CONTENDER","COOPERATE","COPYRIGHT","CORRELATE","COUNTLESS","CULTIVATE","CURIOSITY","DEDICATED","DEFENSIVE","DESIGNATE","DESIRABLE","DETECTION","DETENTION","DEVASTATE","DIAGNOSIS","DIMENSION","DIRECTORY","DISCHARGE","DISCOURSE","DISMISSAL","DOMINANCE","ELABORATE","ELECTORAL","EMERGENCE","EMPIRICAL","ENCOMPASS","ENDEAVOUR","EXCLUSION","EXCLUSIVE","EXECUTION","EXPLOSIVE","EXTREMIST","FILMMAKER","FOREIGNER","FORMULATE","FRANCHISE","GATHERING","GUERRILLA","HIERARCHY","HOSTILITY","IGNORANCE","INABILITY","INCIDENCE","INCLUSION","INDICATOR","INJECTION","INJUSTICE","INSERTION","INTEGRITY","INTENSIFY","INTENSITY","INTENSIVE","INTERFACE","INTERFERE","INTERVENE","INVISIBLE","ISOLATION","LEGENDARY","MACHINERY","MAGNITUDE","MANDATORY","MIGRATION","MUNICIPAL","NONPROFIT","NOTORIOUS","OBJECTION","OBSESSION","OFFSPRING","ORIGINATE","OVERWHELM","PARAMETER","PARTIALLY","PERSONNEL","PHYSICIAN","PORTFOLIO","PRECEDENT","PRECISION","PREGNANCY","PREJUDICE","PRESCRIBE","PRESENTLY","PRINCIPAL","PRIVILEGE","PROCESSOR","PROMINENT","PROSECUTE","PROVISION","REASONING","REBELLION","RECIPIENT","REGULATOR","REJECTION","RELEVANCE","RELUCTANT","REMAINDER","REPRODUCE","RESIDENCE","RESTRAINT","SACRIFICE","SCATTERED","SCEPTICAL","SEEMINGLY","SELECTIVE","SENSATION","SENTIMENT","SEXUALITY","SOCIALIST","SOLICITOR","SPECTACLE","SPOTLIGHT","STABILITY","STABILIZE","STRATEGIC","SUCCESSOR","SUPERVISE","SURRENDER","SUSPICION","SYNTHESIS","TERMINATE","TESTIMONY","THRESHOLD","TOLERANCE","TRADEMARK","UNDERMINE","VIOLATION","WAREHOUSE","WELLBEING","YOUNGSTER",
"ACCELERATE","ACCEPTANCE","ACCESSIBLE","ACCORDANCE","ACCUMULATE","ACCUSATION","ACTIVATION","ADAPTATION","ADJUSTMENT","ADMINISTER","ADOLESCENT","AGGRESSION","ALLEGATION","ALLOCATION","AMBASSADOR","APPLICABLE","ARTICULATE","ASPIRATION","ATTENDANCE","CAPABILITY","CAPITALISM","CAPITALIST","COLLECTIVE","COMMENTARY","COMPARABLE","COMPASSION","COMPELLING","COMPENSATE","COMPETENCE","COMPLEMENT","COMPLEXITY","COMPLIANCE","COMPROMISE","CONCEPTION","CONCESSION","CONFESSION","CONSCIENCE","CONSTITUTE","CONSTRAINT","CONTENTION","CONTRACTOR","CONVERSION","CONVICTION","COORDINATE","CORRECTION","CORRESPOND","CORRUPTION","COUNCILLOR","COUNSELLOR","DEDICATION","DEFICIENCY","DELEGATION","DEPENDENCE","DEPLOYMENT","DIPLOMATIC","DISASTROUS","DISCLOSURE","DISCRETION","DISRUPTION","DISTURBING","ECOLOGICAL","EFFICIENCY","ENGAGEMENT","ENTERPRISE","ENTHUSIAST","EXAGGERATE","EXCELLENCE","EXPLICITLY","FACILITATE","FAVOURABLE","FRUSTRATED","FUNCTIONAL","GOVERNANCE","HARASSMENT","INADEQUATE","INDICTMENT","INDIGENOUS","INEQUALITY","INSPECTION","INTEGRATED","INTRIGUING","IRONICALLY","IRRELEVANT","LEGITIMATE","LIBERATION","LIKELIHOOD","MAGISTRATE","MAINSTREAM","MANIPULATE","MANUSCRIPT","MEANINGFUL","MEDITATION","MISLEADING","NATIONWIDE","NEWSLETTER","NOMINATION","OCCASIONAL","OCCURRENCE","PERSISTENT","PRESIDENCY","PRESUMABLY","PREVALENCE","PREVENTION","PROCEEDING","PROCESSING","PRODUCTIVE","PROFITABLE","PROJECTION","PRONOUNCED","PROPAGANDA","PROSECUTOR","PROSPERITY","PROTECTIVE","PROVINCIAL","REFERENDUM","REFLECTION","REGARDLESS","REGULATORY","REPORTEDLY","RESISTANCE","RESPECTIVE","REVELATION","SEPARATION","SETTLEMENT","SIMULATION","SOLIDARITY","STEREOTYPE","STRUCTURAL","SUBMISSION","SUBSCRIBER","SUBSTITUTE","SUCCESSION","SUCCESSIVE","SUPERVISOR","SUPPLEMENT","SUPPORTIVE","SUPPOSEDLY","SUSPENSION","SUSPICIOUS","SYSTEMATIC","THANKFULLY","THEATRICAL","THEREAFTER","THOUGHTFUL","TRANSCRIPT","TREMENDOUS","UNDERLYING","VULNERABLE","WHATSOEVER","WITHDRAWAL","WORTHWHILE",


];

const gridSize = 10;
const totalCells = gridSize * gridSize;
let board, revealed, wordMap, foundWords, currentPlayer, foundBy, words, usedIndexes;
let resultShown = false;
let clovers = new Set();
let npcTimeoutId = null; // NPC ÌÉÄÏù¥Î®∏ ID Ï∂îÍ∞Ä

const gameEl = document.getElementById('game');
const userScoreEl = document.getElementById('userScore');
const npcScoreEl = document.getElementById('npcScore');
const retryBtn = document.getElementById('retryBtn');

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function getRandomWords(n) {
  const temp = [...wordList];
  shuffle(temp);
  return temp.slice(0, n);
}

function getRandomDirection() {
  const dirs = [
    { x: 1, y: 0 },
  ];
  return dirs[Math.floor(Math.random() * dirs.length)];
}

function canPlaceWord(word, x, y, dx, dy) {
  for (let i = 0; i < word.length; i++) {
    let nx = x + dx * i;
    let ny = y + dy * i;
    if (nx < 0 || ny < 0 || nx >= gridSize || ny >= gridSize) return false;
    let index = ny * gridSize + nx;
    if (board[index] && board[index] !== word[i]) return false;
    if (usedIndexes.has(index)) return false;
  }
  return true;
}

function placeWord(word) {
  for (let attempt = 0; attempt < 100; attempt++) {
    let dir = getRandomDirection();
    let x = Math.floor(Math.random() * gridSize);
    let y = Math.floor(Math.random() * gridSize);
    if (canPlaceWord(word, x, y, dir.x, dir.y)) {
      let positions = [];
      for (let i = 0; i < word.length; i++) {
        let nx = x + dir.x * i;
        let ny = y + dir.y * i;
        let idx = ny * gridSize + nx;
        board[idx] = word[i];
        usedIndexes.add(idx);
        positions.push(idx);
      }
      wordMap[word] = positions;
      return true;
    }
  }
  return false;
}

function placeClovers(count) {
  clovers.clear();
  while (clovers.size < count) {
    const idx = Math.floor(Math.random() * totalCells);
    if (!usedIndexes.has(idx)) clovers.add(idx);
  }
}

function fillEmptyCells() {
  const alphabet = [];
  for (let i = 0; i < 26; i++) {
    alphabet.push(String.fromCharCode(65 + i));
  }
  for (let i = alphabet.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [alphabet[i], alphabet[j]] = [alphabet[j], alphabet[i]];
  }
  let alphabetIndex = 0;
  for (let i = 0; i < totalCells; i++) {
    if (!board[i]) {
      board[i] = alphabet[alphabetIndex % 26];
      alphabetIndex++;
    }
  }
}

function updateScore() {
  userScoreEl.innerHTML = "<h2>USER:</h2>" + foundBy.user.map(w => `<p>${w}</p>`).join("");
  npcScoreEl.innerHTML = "<h2>COMPUTER:</h2>" + foundBy.npc.map(w => `<p>${w}</p>`).join("");
}

function reveal(index) {
  if (revealed[index]) return;
  revealed[index] = true;
  const cell = gameEl.children[index];
  cell.classList.add('revealed');
  cell.textContent = board[index];
}

function checkWords() {
  for (let word of words) {
    if (foundWords.has(word)) continue;
    const positions = wordMap[word];
    if (positions.every(i => revealed[i])) {
      foundWords.add(word);
      let owner = currentPlayer === 'user' ? 'user' : 'npc';
      foundBy[owner].push(word);
      for (let i of positions) {
        gameEl.children[i].classList.add(owner === 'user' ? 'word-owned-user' : 'word-owned-npc');
      }
      updateScore();
    }
  }

  // Í≤åÏûÑ Ï¢ÖÎ£å Ï°∞Í±¥ Ï≤¥ÌÅ¨
  if (foundWords.size === words.length && !resultShown) {
    resultShown = true;
    clearTimeout(npcTimeoutId); // NPC ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
    
    let userCount = foundBy.user.length;
    let npcCount = foundBy.npc.length;
    if (userCount > npcCount) {
      userScoreEl.innerHTML += "<p style='font-size:1.3em; margin-top:10px;'>üéâ ÏäπÎ¶¨</p>";
      npcScoreEl.innerHTML += "<p style='font-size:1.3em; margin-top:10px;'>üò¢ Ìå®Î∞∞</p>";
    } else if (npcCount > userCount) {
      npcScoreEl.innerHTML += "<p style='font-size:1.3em; margin-top:10px;'>üéâ ÏäπÎ¶¨</p>";
      userScoreEl.innerHTML += "<p style='font-size:1.3em; margin-top:10px;'>üò¢ Ìå®Î∞∞</p>";
    } else {
      userScoreEl.innerHTML += "<p style='font-size:1.3em; margin-top:10px;'>ü§ù Î¨¥ÏäπÎ∂Ä</p>";
      npcScoreEl.innerHTML += "<p style='font-size:1.3em; margin-top:10px;'>ü§ù Î¨¥ÏäπÎ∂Ä</p>";
    }
  }
}

function switchTurn() {
  if (resultShown) return; // Í≤åÏûÑ Ï¢ÖÎ£åÏãú ÌÑ¥ Ï†ÑÌôò Î∞©ÏßÄ
  
  currentPlayer = currentPlayer === 'user' ? 'npc' : 'user';
  
  if (currentPlayer === 'npc') {
    npcTimeoutId = setTimeout(() => {
      npcTurn();
    }, 800);
  }
}

function npcTurn() {
  if (resultShown || currentPlayer !== 'npc') {
    return;
  }
  
  let options = [];
  for (let i = 0; i < revealed.length; i++) {
    if (!revealed[i]) {
      options.push(i);
    }
  }
  
  if (options.length === 0) {
    return;
  }
  
  let choice = options[Math.floor(Math.random() * options.length)];
  handleClick(choice);
}

function handleClick(index) {
  if (revealed[index] || resultShown) {
    return;
  }

  let wasClover = false;

  if (clovers.has(index)) {
    wasClover = true;
    const cell = gameEl.children[index];
    cell.classList.add('revealed', 'clover');
    cell.textContent = 'üçÄ';
    revealed[index] = true;

    // ÌÅ¥Î°úÎ≤Ñ Ï£ºÎ≥Ä ÏÖÄÎì§ÎèÑ Í≥µÍ∞ú
    const dx = [0, 0, -1, 1, 0];
    const dy = [-1, 1, 0, 0, 0];
    for (let d = 0; d < dx.length; d++) {
      const nx = index % gridSize + dx[d];
      const ny = Math.floor(index / gridSize) + dy[d];
      if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
        const nIdx = ny * gridSize + nx;
        reveal(nIdx);
      }
    }
  } else {
    reveal(index);
  }

  checkWords();

  // ÌÅ¥Î°úÎ≤ÑÎ•º Ï∞æÏïòÏúºÎ©¥ Í∞ôÏùÄ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Í≥ÑÏÜç, ÏïÑÎãàÎ©¥ ÌÑ¥ ÍµêÏ≤¥
  if (!wasClover && !resultShown) {
    switchTurn();
  } else if (wasClover && currentPlayer === 'npc' && !resultShown) {
    // ÌÅ¥Î°úÎ≤Ñ Î∞úÍ≤¨ÏúºÎ°ú NPCÍ∞Ä Ï∂îÍ∞Ä ÌÑ¥ÏùÑ ÏñªÏóàÏùÑ Îïå
    npcTimeoutId = setTimeout(() => {
      npcTurn();
    }, 800);
  }
}

function init() {
  // Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏ Ï†ïÎ¶¨
  clearTimeout(npcTimeoutId);
  
  board = Array(totalCells).fill(null);
  revealed = Array(totalCells).fill(false);
  wordMap = {};
  foundWords = new Set();
  foundBy = { user: [], npc: [] };
  currentPlayer = 'user';
  usedIndexes = new Set();
  words = getRandomWords(13);
  resultShown = false;
  clovers.clear();

  // Îã®Ïñ¥ Î∞∞Ïπò ÏãúÎèÑ
  let placedWords = 0;
  let attempts = 0;
  while (placedWords < words.length && attempts < 50) {
    if (placeWord(words[placedWords])) {
      placedWords++;
    }
    attempts++;
  }
  
  // Ïã§Ï†úÎ°ú Î∞∞ÏπòÎêú Îã®Ïñ¥Îì§Îßå ÏÇ¨Ïö©
  words = words.slice(0, placedWords);
  
  placeClovers(5);
  fillEmptyCells();
  updateScore();

  gameEl.innerHTML = '';
  for (let i = 0; i < totalCells; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.addEventListener('click', () => {
      if (currentPlayer === 'user' && !resultShown) {
        handleClick(i);
      }
    });
    gameEl.appendChild(cell);
  }
}

retryBtn.addEventListener('click', init);
init();
</script>
</body>
</html>
