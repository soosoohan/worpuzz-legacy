<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WORPUZZ Onomatopoeia</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #209087;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 10px;
  }
  h1 {
    font-size: 3em;
    margin: 20px 0 10px;
    color: #EF0;
  }
  p.rule {
    margin: 0 0 10px;
    font-size: 1em;
    color: #EF0;
    text-align: center;
    line-height: 1.4;
  }
  .container {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    margin-bottom: 10px;
    width: 100%;
    max-width: 800px;
    justify-content: center;
  }
  .score-container {
    display: none;
    flex-direction: column;
    gap: 10px;
    width: 95%;
    max-width: 400px;
  }
  .score-container #npcScore-mobile, 
  .score-container #userScore-mobile {
    background-color: #0E756D;
    color: #fff;
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    border-radius: 12px;
  }
  .score-container #npcScore-mobile h2,
  .score-container #userScore-mobile h2 {
    font-size: 0.9em;
    margin: 0 0 5px;
  }
  .score-container #npcScore-mobile p,
  .score-container #userScore-mobile p {
    font-size: 0.9em;
    display: inline-block;
    margin: 2px 5px;
  }
  #npcScore, #userScore {
    background-color: #0E756D;
    color: #fff;
    width: 180px;
    min-height: 300px;
    padding: 10px;
    box-sizing: border-box;
    border-radius: 12px;
    flex-shrink: 0;
  }
  #npcScore h2, #userScore h2 {
    font-size: 1.2em;
    margin-top: 0;
    margin-bottom: 10px;
  }
  #npcScore p, #userScore p {
    font-size: 1.1em;
    margin: 5px 0;
  }
  #game {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    grid-gap: 5px;
    padding: 10px;
    background-color: #0E756D;
    border-radius: 12px;
    width: 400px;
    height: 400px;
    box-sizing: border-box;
    flex-shrink: 0;
  }
  .cell {
    width: 100%;
    height: 100%;
    aspect-ratio: 1 / 1;
    background-color: #CFF9FF;
    color: #0A6A79;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.3em;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    border-radius: 4px;
  }

.revealed {
    background-color: #fff;
  }
  

  .revealed.clover {
    background-color: #d0f5d0;
    font-size: 1.5em;
  }
  .revealed.clover span {
    font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
  }


.revealed.daisy {
  background-color: #fff4e0; /* Î∞ùÏùÄ Îç∞Ïù¥ÏßÄ ÎäêÎÇåÏùò Î∞∞Í≤Ω */
  font-size: 1.5em;
}
.revealed.daisy span {
  font-family: "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
}


  .word-owned-user {
    background-color: #fff9c4;
  }
  .word-owned-npc {
    background-color: #ffe0e0;
  }
  .btn-container {
    display: flex;
    gap: 10px;
    margin: 15px;
  }
  button {
    font-size: 1.1em;
    padding: 10px 20px;
    cursor: pointer;
    background-color: #CFF9FF;
    color: #0A6A79;
    border-radius: 12px;
    border: none;
  }
  button:hover {
    background-color: #1baf8f;
    color: #fff;
  }
  @media (max-width: 768px) {
    h1 {
      font-size: 2.5em;
      margin: 15px 0 5px;
    }
    p.rule {
      font-size: 0.9em;
      margin: 0 10px 15px;
    }
    .container {
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    #game {
      width: 95%;
      max-width: 400px;
      height: auto;
      aspect-ratio: 1 / 1;
    }
    .btn-container {
      margin: 10px;
      width: 95%;
      max-width: 400px;
      justify-content: center;
    }
    button {
      font-size: 1em;
      padding: 12px 25px;
      flex: 1;
      max-width: 150px;
    }
    .score-container {
      display: flex !important;
    }
    #npcScore, #userScore {
      display: none !important;
    }
  }
</style>
</head>
<body>

<h1>WORPUZZ ONOMATOPOEIA</h1>
<p class="rule">
Find the onomatopoeic words hidden horizontally, vertically, and diagonally in the grid!<br>
If you spot a four-leaf clover <span style="font-family: 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;">üçÄ</span>, you earn an extra turn!<br>
If you spot a daisy <span style="font-family: 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;">üåº</span>, you earn an extra turn!<br>
Compete against the computer ‚Äî whoever finds the most wins!
</p>

<div class="container">
  <div id="npcScore">
    <h2>COMPUTER:</h2>
  </div>
  <div id="game"></div>
  <div id="userScore">
    <h2>USER:</h2>
  </div>
</div>

<div class="score-container">
  <div id="npcScore-mobile">
    <h2>COMPUTER:</h2>
  </div>
  <div id="userScore-mobile">
    <h2>USER:</h2>
  </div>
</div>

<div class="btn-container">
  <button id="retryBtn">RETRY</button>
  <button onclick="location.href='index.html'">HOME</button>
</div>
<script>

const three_to_four_letter_words = [
"AHH","ARF","BAA","BAH","BAM","BAP","BAW","BIP","BOH","BOK","BOO","BOP","BZZ","CAW","COO","EEK","EEP","ERM","FIE","GAG","GEE","GRR","HAW","HEE","HEH","HEM","HIC","HMM","HOO","HOY","HUH","HUM","LAP","LOL","MAA","MEH","MEW","MOO","NOM","NYA","OHO","OOF","OOH","PAH","PEW","PFF","PIP","POP","POW","RAP","RAW","REV","RIP","SHH","SOB","SSS","TCH","UGH","VRR","WAH","WEE","WIZ","WOW","WUB","YAK","YAY","YOW","YUK","YUM","ZAP","ZIP","ZZZ","AAGH","AHEM","AROO","BANG","BARK","BEEP","BIFF","BING","BLAH","BLAT","BLEH","BLEP","BLIP","BLOB","BLOP","BLUB","BOIL","BONG","BONK","BOOF","BOOM","BOOP","BORK","BRAP","BRBR","BRRR","BUMP","BURP","BURR","BUZZ","BZZT","BZZZ","CACK","CHOO","CHOP","CHUG","CHUP","CHUT","CLOP","CROW","DING","DONG","DOOF","DRIP","DROP","DUMP","FIZZ","FNAR","FOOM","FUMP","FUZZ","FWIP","FWOP","GACK","GASP","GECK","GLOP","GLUB","GLUG","GONG","GOSH","GRRR","GULP","GUSH","HAHA","HECK","HEHE","HISS","HMPH","HNGH","HNNG","HOHO","HONK","HOOP","HOOT","HUSH","KECK","KISS","KIYI","LMAO","MAAA","MEEP","MEOW","MIAW","MOOF","MURR","MWAH","MYAU","NYAA","NYAN","OHNO","OINK","OOPS","OUCH","PEEP","PFFT","PHEW","PHOO","PING","PISH","PLAP","PLIP","PLOP","POOF","POOT","PSST","PTUI","PURL","PURR","RING","ROAR","ROWF","RRRR","RUFF","SHOO","SIZZ","SLAP","SNAP","SNIP","SOCK","SPAT","SQRK","SWIP","TADA","TANG","THUD","TING","TOOT","TWIT","UHOH","UMPH","VRRR","WEEP","WHAM","WHAP","WHEW","WHIZ","WHOA","WOOF","YAWP","YEEK","YEEP","YELP","YEOW","YUCK","ZING","ZONK","ZOOM",
];

const five_letter_words = [
"AAAHH","AARGH","AIYEE","AOOGA","BAKAW","BAROO","BELCH","BLARE","BLEAH","BLEAT","BLEEP","BLOOP","BLORT","BLURP","BLURT","BOING","BOINK","BROOM","CHAMP","CHEEP","CHIFF","CHING","CHIRL","CHIRP","CHIRR","CHOMP","CHUCK","CHUFF","CLANG","CLANK","CLASH","CLICK","CLINK","CLOMP","CLONK","CLOOP","CLUCK","CLUMP","CLUNK","COOEE","CRACK","CRASH","CREAK","CROAK","CRUMP","DOING","DOINK","EEHOH","FRACK","FWOOM","GEEHO","GEEWO","GLOOP","GLUCK","GOLLY","GRIND","GROWL","GRRRR","GRUNT","HOHUM","HOOHA","HOOSH","HUMPH","KABAM","KAZOO","KNOCK","MMMMM","MUNCH","NEIGH","NHHMM","OOMPH","PHEEP","PLASH","PLINK","PLONK","PLOOP","PLUNK","PSHAW","QUACK","QUONK","QUORK","RETCH","ROOOF","SCREE","SCUFF","SHINK","SHUNK","SHUSH","SKRRT","SLASH","SLOSH","SLURP","SMACK","SNARF","SNARK","SNARL","SNIFF","SNIKT","SNORE","SNORT","SPANG","SPANK","SPLAT","STRUM","SWISH","THOCK","THRUM","THUMP","THUNK","THWIP","TOING","TRALA","TRUMP","TWANG","TWEET","TWITE","UHHUH","ULULU","VROOM","WHACK","WHANG","WHIRR","WHISK","WHIST","WHIZZ","WHOOP","WOWIE","YAHOO","YIKES","YOINK","ZOOKS","ZZZZZ",
];

const six_letter_words =  [
"AAAAAH","AAARGH","AHCHOO","ATCHOO","BABBLE","BLOOSH","BOINGY","BOOHOO","BOWWOW","BRAAAM","BUBBLE","BURBLE","BZZZZZ","CACKLE","CAWCAW","CHUGGA","CHUPSE","CICADA","CRUNCH","CUCKOO","DOOWOP","FIZZLE","FWOOSH","GECKER","GEEHUP","GIGGLE","GOBBLE","GUFFAW","GURGLE","HAHAHA","HALLOO","HEEHAW","HEEHEE","HICCUP","HISSSS","HOOPEE","HOOPLA","HOORAH","HOORAY","HURRAH","HURRAY","JANGLE","JINGLE","KABLAM","KABOOM","KAZOOM","LADIDA","LUBDUB","MOOMOO","MUTTER","NEENAR","NEENOR","NICKER","NUMNUM","PATTER","PEEPEE","PEWPEW","POPPLE","PRRRRT","PTOOEY","RATTLE","RIBBIT","RUMBLE","RUSTLE","RUTTLE","SCHLUP","SHLICK","SHRILL","SHUCKS","SIRRAH","SIZZLE","SKOOSH","SLAVER","SLURRP","SPLASH","SPLISH","SPLOSH","SPLURT","SQUALL","SQUAWK","SQUEAK","SQUIRT","SQUISH","STEUPS","TCHICK","TEEHEE","THWOMP","TICTAC","TINKLE","TOMTOM","TUWHOO","VAROOM","WAAAAH","WAHWAH","WARBLE","WHINNY","WHOOSH","WHUMPF","WOOHOO","WOOWOO","YAPYAP","YIPPEE","YOICKS","YUMYUM",];


const seven_letter_words =  [
"AAAARGH","ATISHOO","BLUBBER","BOOWOMP","BWAHAHA","CHATTER","CHITTER","CHUCKLE","CHUFFLE","CRACKLE","CRINKLE","CRUMPLE","DRIZZLE","GRUMBLE","HARUMPH","KATCHOO","KATYDID","KERCHOO","KSSSHHH","RATATAT","RRRRRRR","RUBADUB","SCHLURP","SCHWING","SCREECH","SCRUNCH","SHATTER","SKITTER","SLABBER","SPLOOSH","SPROING","SWOOOSH","TANTARA","THUNDER","TOOMMMM","TRALALA","TRICKLE","TRUMPET","TWEEDLE","ULULATE","WHIFFLE","WHOOOSH","WHOOPEE",
];

const eight_or_more_letter_words =  [
"ALLEYOOP","BACKFIRE","BADUMTSS","BLUBBLUB","BLUPBLUP","BURRBURR","CHACHING","CHAKCHAK","CHOOCHOO","CHOPCHOP","CHUGCHUG","CLAPCLAP","CLIPCLOP","CRRUUNCH","DINGDING","DINGDONG","DRIPDROP","GULPGULP","HONKHONK","HOOTHOOT","KABLOOIE","KERCHING","KERPLUNK","KOFFKOFF","OINKOINK","OMNOMNOM","PEEKABOO","PINGPONG","PLINKETY","PLOPPLOP","PUFFPUFF","SLAMBANG","SPLUTTER","SWOOOOSH","TICKTACK","TICKTOCK","TOOTTOOT","WHIRWHIR","WOMPWOMP","WOOOWOOO","WUFFWUFF","BADUMTISH","CHOPSCHOP","FEEFAWFUM","MUAHAHAHA","RINGALING","TAPTAPTAP","BADUMCHING","CHIRPCHIRP","CLANGCLANG","CLICKCLACK","HUBBAHUBBA","HURLYBURLY","KNOCKKNOCK","QUACKQUACK","RATATATTAT","SLICESLICE","TWEETTWEET","WEEOOWEEOO","WHOOPWHOOP","YACKETYYAK","COCKADOODLE",

];


// Í∞Å Í∏∏Ïù¥Î≥Ñ Îã®Ïñ¥ Í∞úÏàò ÏÑ§Ï†ï

const num_three_to_four = 3;
const num_five = 3;
const num_six = 3;
const num_seven = 2;
const num_eight_or_more = 2;

const gridSize = 10;
const totalCells = gridSize * gridSize;
let board, revealed, wordMap, foundWords, currentPlayer, foundBy, words, usedIndexes;
let resultShown = false;
let clovers = new Set();
let daisies = new Set(); // üåº Îç∞Ïù¥ÏßÄ Set Ï∂îÍ∞Ä
let npcTimeoutId = null;



const gameEl = document.getElementById('game');
const userScoreEl = document.getElementById('userScore');
const npcScoreEl = document.getElementById('npcScore');
const userScoreMobileEl = document.getElementById('userScore-mobile');
const npcScoreMobileEl = document.getElementById('npcScore-mobile');
const retryBtn = document.getElementById('retryBtn');

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function getRandomSample(array, count) {
  const shuffled = [...array];
  shuffle(shuffled);
  return shuffled.slice(0, Math.min(count, array.length));
}


function getRandomWords() {
  let selectedWords = []
    .concat(getRandomSample(three_to_four_letter_words, num_three_to_four)) // ‚úÖ ÏàòÏ†ïÎêú Î∂ÄÎ∂Ñ
    .concat(getRandomSample(five_letter_words, num_five))
    .concat(getRandomSample(six_letter_words, num_six))
    .concat(getRandomSample(seven_letter_words, num_seven))
    .concat(getRandomSample(eight_or_more_letter_words, num_eight_or_more));
  shuffle(selectedWords);
  return selectedWords;
}


function getRandomDirection() {
  const dirs = [{ x: 1, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 1 }];
  return dirs[Math.floor(Math.random() * dirs.length)];
}

function canPlaceWord(word, x, y, dx, dy) {
  for (let i = 0; i < word.length; i++) {
    let nx = x + dx * i;
    let ny = y + dy * i;
    if (nx < 0 || ny < 0 || nx >= gridSize || ny >= gridSize) return false;
    let index = ny * gridSize + nx;
    if (board[index] && board[index] !== word[i]) return false;
    if (usedIndexes.has(index)) return false;
  }
  return true;
}

function placeWord(word) {
  for (let attempt = 0; attempt < 100; attempt++) {
    let dir = getRandomDirection();
    let x = Math.floor(Math.random() * gridSize);
    let y = Math.floor(Math.random() * gridSize);
    if (canPlaceWord(word, x, y, dir.x, dir.y)) {
      let positions = [];
      for (let i = 0; i < word.length; i++) {
        let nx = x + dir.x * i;
        let ny = y + dir.y * i;
        let idx = ny * gridSize + nx;
        board[idx] = word[i];
        usedIndexes.add(idx);
        positions.push(idx);
      }
      wordMap[word] = positions;
      return true;
    }
  }
  return false;
}

function placeClovers(count) {
  clovers.clear();
  while (clovers.size < count) {
    const idx = Math.floor(Math.random() * totalCells);
    if (!usedIndexes.has(idx)) clovers.add(idx);
  }
}

function placeDaisy() {
  daisies.clear();
  while (daisies.size < 1) { // Îç∞Ïù¥ÏßÄÎäî ÌïòÎÇòÎßå
    const idx = Math.floor(Math.random() * totalCells);
    if (!usedIndexes.has(idx) && !clovers.has(idx)) {
      daisies.add(idx);
    }
  }
}

function fillEmptyCells() {
  const alphabet = Array.from({ length: 26 }, (_, i) => String.fromCharCode(65 + i));
  shuffle(alphabet);
  let index = 0;
  for (let i = 0; i < totalCells; i++) {
    if (!board[i]) {
      board[i] = alphabet[index % 26];
      index++;
    }
  }
}

   
function updateScore() {
  const userContent = "<h2>USER:</h2>" + foundBy.user.map(w => `<p>${w}</p>`).join("");
  const npcContent = "<h2>COMPUTER:</h2>" + foundBy.npc.map(w => `<p>${w}</p>`).join("");
  userScoreEl.innerHTML = userContent;
  npcScoreEl.innerHTML = npcContent;
  if (userScoreMobileEl && npcScoreMobileEl) {
    userScoreMobileEl.innerHTML = userContent;
    npcScoreMobileEl.innerHTML = npcContent;
  }
}

function checkWords() {
  for (let word of words) {
    if (foundWords.has(word)) continue;
    const positions = wordMap[word];
    if (positions.every(i => revealed[i])) {
      foundWords.add(word);
      const owner = currentPlayer === 'user' ? 'user' : 'npc';
      foundBy[owner].push(word);
      positions.forEach(i => gameEl.children[i].classList.add(owner === 'user' ? 'word-owned-user' : 'word-owned-npc'));
      updateScore();
    }
  }
  if (foundWords.size === words.length && !resultShown) {
    resultShown = true;
    clearTimeout(npcTimeoutId);
    const userCount = foundBy.user.length;
    const npcCount = foundBy.npc.length;
    let userMessage = '';
    let npcMessage = '';
    if (userCount > npcCount) {
      userMessage = "<span style='font-family:\"Apple Color Emoji\", \"Segoe UI Emoji\", sans-serif;'>üèÜ</span> [WIN!!]";
      npcMessage = "<span style='font-family:\"Apple Color Emoji\", \"Segoe UI Emoji\", sans-serif;'>ü•à</span> [LOSE~]";
    } else {
      userMessage = "<span style='font-family:\"Apple Color Emoji\", \"Segoe UI Emoji\", sans-serif;'>ü•à</span> [LOSE~]";
      npcMessage = "<span style='font-family:\"Apple Color Emoji\", \"Segoe UI Emoji\", sans-serif;'>üèÜ</span> [WIN!]";
    }
 

    if (userMessage && npcMessage) {
      userScoreEl.innerHTML += `<p style='font-size:1.3em; margin-top:10px; color:#FFD700; font-weight:bold;'>${userMessage}</p>`;
      npcScoreEl.innerHTML += `<p style='font-size:1.3em; margin-top:10px; color:#FFD700; font-weight:bold;'>${npcMessage}</p>`;
      if (userScoreMobileEl && npcScoreMobileEl) {
        userScoreMobileEl.innerHTML += `<p style='font-size:1.1em; margin-top:10px; color:#FFD700; font-weight:bold;'>${userMessage}</p>`;
        npcScoreMobileEl.innerHTML += `<p style='font-size:1.1em; margin-top:10px; color:#FFD700; font-weight:bold;'>${npcMessage}</p>`;
      }
    }
  }
}

function reveal(index) {
  if (revealed[index]) return;
  revealed[index] = true;
  const cell = gameEl.children[index];
  cell.classList.add('revealed');
  cell.textContent = board[index];
}

function switchTurn() {
  if (resultShown) return;
  currentPlayer = currentPlayer === 'user' ? 'npc' : 'user';
  if (currentPlayer === 'npc') {
    npcTimeoutId = setTimeout(npcTurn, 800);
  }
}

function npcTurn() {
  if (resultShown || currentPlayer !== 'npc') return;
  const options = revealed.reduce((acc, r, i) => (!r ? [...acc, i] : acc), []);
  if (options.length === 0) return;
  const choice = options[Math.floor(Math.random() * options.length)];
  handleClick(choice);
}

function handleClick(index) {
  if (revealed[index] || resultShown) return;
  let wasClover = false;
  let wasDaisy = false;

  const cell = gameEl.children[index];

  if (clovers.has(index)) {
    wasClover = true;
    cell.classList.add('revealed', 'clover');
    cell.innerHTML = '<span>üçÄ</span>';
    revealed[index] = true;

    const dx = [0, 0, -1, 1, 0];
    const dy = [-1, 1, 0, 0, 0];

    for (let d = 0; d < dx.length; d++) {
      const nx = index % gridSize + dx[d];
      const ny = Math.floor(index / gridSize) + dy[d];
      if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
        const nIdx = ny * gridSize + nx;
        reveal(nIdx);
      }
    }

  } else if (daisies.has(index)) {
    wasDaisy = true;
    cell.classList.add('revealed', 'daisy');
    cell.innerHTML = '<span>üåº</span>';
    revealed[index] = true;

    for (let dx = -1; dx <= 1; dx++) {
      for (let dy = -1; dy <= 1; dy++) {
        const nx = index % gridSize + dx;
        const ny = Math.floor(index / gridSize) + dy;
        if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
          const nIdx = ny * gridSize + nx;
          reveal(nIdx);
        }
      }
    }

  } else {
    reveal(index);
  }

  checkWords();

  if ((!wasClover && !wasDaisy) && !resultShown) {
    switchTurn();
  } else if ((wasClover || wasDaisy) && currentPlayer === 'npc' && !resultShown) {
    npcTimeoutId = setTimeout(npcTurn, 800);
  }
}

  
function init() {
  clearTimeout(npcTimeoutId);
  board = Array(totalCells).fill(null);
  revealed = Array(totalCells).fill(false);
  wordMap = {};
  foundWords = new Set();
  foundBy = { user: [], npc: [] };
  currentPlayer = 'user';
  usedIndexes = new Set();
  words = getRandomWords();
  resultShown = false;
  clovers.clear();
daisies.clear()
  let placedWords = 0;
  let attempts = 0;
  while (placedWords < words.length && attempts < 50) {
    if (placeWord(words[placedWords])) placedWords++;
    attempts++;
  }
  words = words.slice(0, placedWords);

  placeClovers(5);
placeDaisy(1); 
  fillEmptyCells();
  updateScore();

  gameEl.innerHTML = '';
  for (let i = 0; i < totalCells; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.addEventListener('click', () => {
      if (currentPlayer === 'user' && !resultShown) handleClick(i);
    });
    gameEl.appendChild(cell);
  }

  
  console.log('Í≤åÏûÑÏóê Î∞∞ÏπòÎêú Îã®Ïñ¥Îì§:', words);
}

retryBtn.addEventListener('click', init);
window.addEventListener('resize', updateLayout);

function updateLayout() {
  const isMobile = window.innerWidth <= 768;
  if (isMobile) {
    npcScoreEl.style.display = 'none';
    userScoreEl.style.display = 'none';
    document.querySelector('.score-container').style.display = 'flex';
  } else {
    npcScoreEl.style.display = 'block';
    userScoreEl.style.display = 'block';
    document.querySelector('.score-container').style.display = 'none';
  }
}

updateLayout();
init();
</script>
</body>
</html>
